<!doctype html>
<html lang="ja">
<head>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0ea5e9">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Super Fast Shopping List</title>
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body{height:100%;}
    body{font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol"}
    .fade-enter{opacity:0; transform:translateY(4px)}
    .fade-enter-active{opacity:1; transform:translateY(0); transition:opacity .12s ease, transform .12s ease}
  </style>
</head>
<body class="bg-zinc-50 text-zinc-900">
  <main class="max-w-md mx-auto p-4 sm:p-6">
    <header class="sticky top-0 bg-zinc-50/90 backdrop-blur z-10 -mx-4 px-4 pt-3 pb-4 border-b border-zinc-200">
      <h1 class="text-xl font-semibold">🛒 Shopping List</h1>
      <p class="text-sm text-zinc-500">Fast. Simple. Yours.</p>
    </header>

    <!-- Input Row -->
    <section class="mt-4">
      <div class="flex gap-2">
        <input id="itemInput" type="text" inputmode="text" autocomplete="off" placeholder="Add an item… (例: 牛乳 2)"
               class="flex-1 rounded-xl border border-zinc-300 bg-white px-3 py-3 text-base outline-none focus:ring-2 focus:ring-sky-400 focus:border-sky-400" />
        <button id="addBtn" class="rounded-xl px-4 py-3 bg-sky-500 text-white font-medium active:scale-[.98]">Add</button>
      </div>
      <div class="mt-2 flex flex-wrap gap-2 text-xs text-zinc-500">
        <span>Enterで追加</span>
        <span>・</span>
        <span>チェックすると即削除（Undo可）</span>
      </div>
    </section>

    <!-- Actions -->
    <section class="mt-4 flex items-center justify-between text-sm">
      <div class="flex gap-2">
        <button id="sortBtn" class="px-3 py-2 rounded-lg border border-zinc-300 hover:bg-zinc-100">Sort A→Z</button>
        <button id="shareBtn" class="px-3 py-2 rounded-lg border border-zinc-300 hover:bg-zinc-100">Copy</button>
      </div>
      <button id="clearBtn" class="px-3 py-2 rounded-lg border border-rose-300 text-rose-600 hover:bg-rose-50">Clear All</button>
    </section>

    <!-- List -->
    <ul id="list" class="mt-3 space-y-2"></ul>

    <!-- Snackbar -->
    <div id="snackbar" class="fixed left-1/2 -translate-x-1/2 bottom-6 hidden">
      <div class="rounded-full bg-zinc-900 text-white text-sm px-4 py-2 shadow-lg flex items-center gap-3">
        <span id="snackbarText">Removed</span>
        <button id="undoBtn" class="underline underline-offset-2">Undo</button>
      </div>
    </div>

    <footer class="mt-10 text-center text-xs text-zinc-400">
      <p>Local-only · Auto-save · No accounts</p>
    </footer>
  </main>

<script>
(() => {
  const STORAGE_KEY = 'superfast-shopping-list.v1';
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const input = $('#itemInput');
  const addBtn = $('#addBtn');
  const listEl = $('#list');
  const clearBtn = $('#clearBtn');
  const sortBtn = $('#sortBtn');
  const shareBtn = $('#shareBtn');
  const snackbar = $('#snackbar');
  const snackbarText = $('#snackbarText');
  const undoBtn = $('#undoBtn');

  /** state **/
  let items = load();
  let lastRemoved = null; // {item, index}

  render();

  // Add item
  function addItemFromInput(){
    const val = input.value.trim();
    if(!val) return;
    const newItem = { id: crypto.randomUUID(), text: val, createdAt: Date.now() };
    items.push(newItem);
    save();
    render(true);
    input.value='';
    input.focus();
  }

  input.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter') addItemFromInput();
  });
  addBtn.addEventListener('click', addItemFromInput);

  // Clear
  clearBtn.addEventListener('click', () => {
    if(items.length === 0) return;
    if(confirm('Clear all items?')){
      items = [];
      save();
      render();
    }
  });

  // Sort
  let asc = true;
  sortBtn.addEventListener('click', ()=>{
    items.sort((a,b)=> asc ? a.text.localeCompare(b.text) : b.text.localeCompare(a.text));
    asc = !asc;
    sortBtn.textContent = asc ? 'Sort A→Z' : 'Sort Z→A';
    save();
    render();
  });

  // Share / Copy
  shareBtn.addEventListener('click', async ()=>{
    const txt = items.map(x=> `• ${x.text}`).join('\n');
    try{
      if(navigator.share){
        await navigator.share({ text: txt || '(empty)' });
      } else {
        await navigator.clipboard.writeText(txt);
        flashSnackbar('Copied to clipboard');
      }
    } catch(err){
      await navigator.clipboard.writeText(txt);
      flashSnackbar('Copied to clipboard');
    }
  });

  // Undo
  undoBtn.addEventListener('click', ()=>{
    if(!lastRemoved) return;
    items.splice(lastRemoved.index, 0, lastRemoved.item);
    lastRemoved = null;
    save();
    render();
    hideSnackbar();
  });

  // Helpers
  function save(){
    try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); }catch(e){}
  }
  function load(){
    try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }catch(e){ return []; }
  }
  function render(animate=false){
    listEl.innerHTML = '';
    for(const it of items){
      const li = document.createElement('li');
      li.className = 'flex items-center gap-3 bg-white border border-zinc-200 rounded-xl px-3 py-2';

      const cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.className = 'size-5 accent-sky-500';
      cb.addEventListener('change', () => removeItem(it.id));

      const span = document.createElement('span');
      span.textContent = it.text;
      span.className = 'flex-1 text-[15px]';

      const del = document.createElement('button');
      del.textContent = '✕';
      del.className = 'text-zinc-400 hover:text-rose-600 px-2';
      del.addEventListener('click', () => removeItem(it.id));

      li.appendChild(cb);
      li.appendChild(span);
      li.appendChild(del);

      if(animate){
        li.classList.add('fade-enter');
        requestAnimationFrame(()=> li.classList.add('fade-enter-active'));
        setTimeout(()=> li.classList.remove('fade-enter','fade-enter-active'), 160);
      }

      listEl.appendChild(li);
    }
  }

  function removeItem(id){
    const idx = items.findIndex(x=> x.id === id);
    if(idx === -1) return;
    lastRemoved = { item: items[idx], index: idx };
    items.splice(idx,1);
    save();
    render();
    flashSnackbar('Removed.');
  }

  let sbTimer;
  function flashSnackbar(msg){
    snackbarText.textContent = msg;
    snackbar.classList.remove('hidden');
    clearTimeout(sbTimer);
    sbTimer = setTimeout(hideSnackbar, 3000);
  }
  function hideSnackbar(){ snackbar.classList.add('hidden'); }

  // Pull-to-clear (optional, long-press on header clears checked if将来対応…)
})();
</script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js');
    });
  }
</script>

</body>
</html>

